---
layout: page
title: APIs.json Annotation
---
<style>
    input[type=text] {
     width: 100%;
     padding: 15px 8px 15px 8px;
    }
    input[type=email] {
     width: 100%;
     padding: 15px 8px 15px 8px;
    }
    textarea {
        width: 100%;
        height: 150px;
    }

    .specListing{

    }
    .pathname{
      font-size: 11px;
    }
    .method{
      font-size: 11px;
    }
    .messagedetails{
      font-size: 11px;
      padding: 8px;
    }
    .commentdetails{
      font-size: 11px;
      padding: 8px;
    }
</style>

<h1>APIs.json Annotation</h1>
<p>This is an exmple of autocomplete done client side with <a href="/apis.json">this projects APIs.json</a>, providing access to the paths, verbs, and tags contained within an APIs.json collection.</p>
<script type="text/jscript">

if(getUrlVar('token'))
  {
    var $oAuth_Token = getUrlVar('token');
  }

var $org = 'api-evangelist-tools';
var $repo = 'apis-json-annotation';
var $user = 'kinlane';

var $apiurl = "";
var $Pallette = {};
var $FullCount = 0;
var $pathArray = [];
var $verbArray = [];
var $tagArray = [];

function sendIssue()
  {
    $message_path = $("#message_path").val();
    $message_method = $("#message_method").val();
    $message_body = $("#message_body").val();

    var github = new Github({token: $oAuth_Token,auth: "oauth"});
    var $authuser = github.getUser();
    var $userdetails = $authuser.show(null, function(err, user) {
      var issues = github.getIssues($org, $repo);
      var options = {
        title: $message_path,
        body: $message_body,
        assignee: user['login'],
        labels: [
          $message_method
        ]
      };

      issues.create(options, function(err, issue) {
          addMessageField($message_path,$message_method);
       });

    });
  }

  function sendComment()
    {
      $message_path = $("#message_path").val();
      $message_method = $("#message_method").val();
      $message_number = $("#message_number").val();
      $comment_body = $("#comment_body").val();
      $comments_url = '/repos/' + $org + '/' + $repo + '/issues/' + $message_number + '/comments';

      var $issue = {
        comments_url: [
          $comments_url
        ]
      };

      var github = new Github({token: $oAuth_Token,auth: "oauth"});
      var $authuser = github.getUser();
      var $userdetails = $authuser.show(null, function(err, user) {

        var $issues = github.getIssues($org, $repo);
        $issues.comment($issue, $comment_body, function(err, comment) {
        addMessageField($message_path,$message_method);
        });

      });
    }

function addMessageField($message_path,$message_method)
  {
    var options = {
      labels: [
        $message_method
      ]
    };

    document.getElementById("specMessenger").innerHTML = '';

    var $github = new Github({token: $oAuth_Token,auth: "oauth"});
    var $issues = $github.getIssues($org,$repo);
    var $allIssues = $issues.list(options, function(err, $issues) {
      if($issues.length>0)
        {

        $issue_count = 1;
        $html = '<table width="100%" id="messageListing" border="0" style="width: 100%; border: 0px solid #000;"></table>';
        $('#specMessenger').append($html);

        $.each($issues, function($issueKey, $issueValue) {

          $message_id = $issueValue['id'];
          $message_number = $issueValue['number'];
          $message_body = $issueValue['body'];
          $message_html_url = $issueValue['html_url'];
          $message_created_at = $issueValue['created_at'];
          $message_title = $issueValue['title'];
          $comments_url = $issueValue['comments_url'];
          $message_user = $issueValue['user']['login'];

          if($message_path == $message_title)
            {

            $html = '<tr><td colspan="3" class="messagedetails">';
            $html = $html + '<a href="' + $message_html_url + '" target="_blank" title="Visit Issue Thread On Github"><img src="https://s3.amazonaws.com/kinlane-productions/bw-icons/bw-arrow-right.png" align="right" width="25" /></a>';
            $html = $html + '<span style="font-size: 16px;"><strong>' + $message_title + '(' + $message_method + ')</strong></span><br />';
            $html = $html + '<strong>' + $message_user + ': </strong>' + $message_body + '';
            $html = $html + '</td></tr>';
            $('#messageListing').append($html);

            var options = {
              number: [
                $message_number
              ]
            };

            var $comments = $github.getComments($org,$repo);
            var $allComments = $comments.list(options, function(err, $comments) {

              $.each($comments, function($commentKey, $commentValue) {

                $comment_body = $commentValue['body'];
                $comment_created_at = $commentValue['created_at'];
                $comment_user = $commentValue['user']['login'];

                var date = new Date($comment_created_at);
                $comment_created_at = (date.getMonth() + 1) + '/' + date.getDate() + '/' +  date.getFullYear();
                $html = '<tr style="border-top: 1px solid #000;"><td colspan="3" class="commentdetails">';
                $html = $html + '<strong>' + $comment_user + ':</strong> <i>(' + $comment_created_at + ')</i> ' + $comment_body + '';
                $html = $html + '</td></tr>';
                $('#messageListing').append($html);

                });
              });

            }

          if($issue_count==$issues.length)
            {
            $html = '<form name="addContentForm">';
            $html = $html + '<input type="hidden" name="message_method" id="message_method" value="' + $message_method + '" style="width: 100%;" />';
            $html = $html + '<input type="hidden" name="message_path" id="message_path" value="' + $message_path + '" style="width: 100%;" />';
            $html = $html + '<input type="hidden" name="message_number" id="message_number" value="' + $message_number + '" style="width: 100%;" />';
            $html = $html + '<table border="0" width="100%" style="width: 100%; border-top: 1px solid #000; margin-top: 5px;">';
            $html = $html + '<tr>';
            $html = $html + '<td colspan="3">';
            $html = $html + '<input type="text" name="comment_body" id="comment_body" style="width: 100%; height: 100px;" />';
            $html = $html + '<center><input type="button" name="addcomment" value="Add Comment" onclick="sendComment();" /></center>';
            $html = $html + '</td>';
            $html = $html + '</tr>';
            $html = $html + '</table>';
            $html = $html + '</form>';
            $('#specMessenger').append($html);
            }
          $issue_count++;

          });
        }
      else
        {
        $html = '<form name="addMessageForm">';
        $html = $html + '<input type="hidden" name="message_method" id="message_method" value="' + $message_method + '" style="width: 100%;" />';
        $html = $html + '<input type="hidden" name="message_path" id="message_path" value="' + $message_path + '" style="width: 100%;" />';
        $html = $html + '<table border="0" width="100%" style="width: 100%;">';
        $html = $html + '<tr>';
        $html = $html + '<td colspan="3">';
        $html = $html + '<input type="text" name="message_body" id="message_body" style="width: 100%; height: 200px;" />';
        $html = $html + '<center><input type="button" name="addmessage" value="Start Thread On This Endpoint" onclick="sendIssue();" /></center>';
        $html = $html + '</td>';
        $html = $html + '</tr>';
        $html = $html + '</table>';
        $html = $html + '</form>';
        $('#specMessenger').append($html);
        }
     });
  }

function processAPIsJSON($apisjsonURL)
{

  $apiHumanURL = "";

  $FullCount = $FullCount + 1;

  var loadIt = $.getJSON($apisjsonURL, function($apisJSON) {

    $masterName = $apisJSON['name'];
    //$html = '<p><strong>' + $masterName + '</strong></p>';
    //$('#specViewer').append($html);

    $masterDesc = $apisJSON['description'];
    $masterLogo = $apisJSON['image'];
    $masterURL = $apisJSON['url'];
    $masterTags = $apisJSON['tags'];

    $.each($apisJSON['apis'], function(apiKey, apiVal) {

      $apiName = apiVal['name'];
      $html = '<tr><td colspan="3">';
      $html = $html + '<strong>' + $apiName + '</strong><br />';
      $html = $html + '</td></tr>';
      $('#specListing').append($html);

      $apiHumanURL = apiVal['humanURL'];
      $apiBaseURL = apiVal['baseURL'];

      $apiProperties = apiVal['properties'];

      $.each($apiProperties, function(propertyKey, propertyValue) {

        $type = propertyValue['type'];
        $url = propertyValue['url'];

        if($type=='x-openapi-spec')
          {

          $FullCount = $FullCount + 1;

          if(!$url.indexOf('http') > -1)
            {
            $baseSite = $apisJSON['url'].replace('apis.json','');
            $pull_url = $baseSite + $url;
            }
          else
            {
            $pull_url = $url;
            }

          var loadIt3 = $.getJSON($pull_url, function($openapispec) {

            $paths = $openapispec['paths'];
            $title = $openapispec['info']['title'];

            $apiSlug = $title.replace(/ /g,"-");
            $apiSlug = $apiSlug.toLowerCase();

            // show the unique host
            $host = $openapispec['host'];
            $basepath = $openapispec['basePath'];

            $html = '<tr><td colspan="3"><strong>Host:</strong> ' + $host + '</td></tr>';
            $('#specListing').append($html);

            $html = '<tr><td colspan="3"><strong>Base Path:</strong> ' + $basepath + '</td></tr>';
            $('#specListing').append($html);

            $.each($paths, function(pathKey, pathValue) {

              $path_name = pathKey;

              $pathexist = 0;
              $.each($verbArray, function(key, value) {if(value == $path_name){ $pathexist = 1; }});
              if($pathexist==0) {  $pathArray.push($path_name); }

              $.each(pathValue, function(methodKey, methodValue) {

                $method = methodKey;
                $method = $method.toUpperCase();

                $sQuote = String.fromCharCode(39);

                $html = '<tr>';
                $html = $html + '<td class="pathname">' + $path_name + '</td>';
                $html = $html + '<td class="method" width="35">(' + $method + ')</td>';
                $html = $html + '<td width="50" onclick="addMessageField(' + $sQuote + $path_name + $sQuote + ',' + $sQuote + $method + $sQuote + '); return false;"><img src="https://s3.amazonaws.com/kinlane-productions/bw-icons/bw-messaging-system.png" width="25" /></td>';
                $html = $html + '</tr>';
                //console.log($html);
                $('#specListing').append($html);

                $methodexist = 0;
                $.each($verbArray, function(key, value) { if(value == $method){ $methodexist = 1; }});
                if($methodexist==0) { $verbArray.push($method); }

                $method_summary = methodValue['summary'];
                $tags = methodValue['tags'];

                $.each($tags, function($tagKey, $tagValue) {

                  $tag = $tagValue;
                  $tag = $tag.trim();
                  $tagslug = $tag.replace(/ /g,"-");
                  $tagslug = $tagslug.toLowerCase();
                  $tag = $tag.charAt(0).toUpperCase() + $tag.slice(1);

                  $tagexists = 0;
                  $.each($tagArray, function(key, value) { if(value == $tag){ $tagexists = 1; } });
                  if($tagexists==0) { $tagArray.push($tag);  }

                });
              });
            });


          });

          loadIt3.complete(function() {

            $FullCount = $FullCount - 1;
            if($FullCount==0){

              // Load What We Want
              $(function() {

                // Do Something

              });
            }
          });
        }
      });
    });
  });

}

$apisjsonURL = "/apis.json";
processAPIsJSON($apisjsonURL);

</script>

<table width="100%" cellpadding="2" cellspacing="2" border"0">
  <tr>
    <td width="60%" valign="top" id="specViewer">
      <table width="100%" id="specListing" border="0" style="width: 100%; border: 0px solid #000;"></table>'
    </td>
    <td width="40%" valign="top" id="specMessenger"></td>
  </tr>
</table>

<p>I am just exploring different ways of working with the surface area of an API, using machine readable API definitions like APIs.json and OpenAPI Spec.</p>
